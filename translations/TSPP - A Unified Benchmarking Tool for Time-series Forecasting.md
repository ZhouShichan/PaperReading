<link rel="stylesheet" type="text/css" href="http://zlyd.iccnconn.com/markdowncss/stylelib/swot-aligncenter-default.css">

# TSPP - A Unified Benchmarking Tool for Time-series Forecasting

> J. Bączek et al., “TSPP: A Unified Benchmarking Tool for Time-series Forecasting.” arXiv, Dec. 28, 2023. Accessed: Dec. 31, 2023. [Online]. Available: <http://arxiv.org/abs/2312.17100>

## 摘要

尽管机器学习取得了显著的进展，但重点主要集中在数据获取和模型创建上。然而，在实际环境中全面评估机器学习解决方案需要整个流程的标准化。这一需求在时间序列预测中尤为迫切，因为各种各样的设置妨碍了对不同方法进行有意义的比较。为了弥合这一差距，我们提出了一个统一的基准测试框架，揭示了在开发时间序列预测模型时涉及的关键建模和机器学习决策。该框架促进了模型和数据集的无缝集成，有助于从业者和研究人员在他们的开发工作中。我们在这一框架内对最近提出的模型进行了基准测试，展示了经过精心实施的深度学习模型只需付出最小的努力，就能与需要进行大量特征工程和专业知识的梯度提升决策树相匹敌。该框架可以在[这里](https://github.com/NVIDIA/DeepLearningExamples/tree/master/Tools/PyTorch/TimeSeriesPredictionPlatform)。

## 介绍

时间序列预测在金融、天气预报、需求预测等领域发挥着至关重要的作用。准确的预测使企业能够优化决策、增强运营并提高整体效率。然而，时间序列数据固有的复杂性，包括趋势、噪声、缺失值和变量之间不断变化的关系，对实现准确预测提出了重大挑战。
为了应对时间序列预测的挑战，出现了多种方法。
梯度增强机(Gradient boosting machines, GBM)因其有效性而在Kaggle竞赛中变得流行，但需要大量的特征工程工作。虽然很有前途，但深度学习模型独立使用的频率较低，主要是由于数据限制。NN3竞赛旨在展示神经网络(NNs)在时间序列预测方面的可行性，但2011年发表的初步结果令人失望，突出了统计方法的主导地位。2017年的Web流量时间序列预测竞赛进一步证实了这一点，机器学习方法在丰富且同质的数据中表现更好。同样，著名的M4竞争证明了统计方法在异构数据上的优越性。
尽管有这种趋势，RNN和统计模型相结合的集成赢得了比赛，尽管尚不清楚这是否标志着向深度学习的转变。随后的M5竞赛，利用沃尔玛的真实销售数据，见证了梯度增强机的优势，第二名的解决方案利用了GBM和神经网络的集合。这表明向深度学习架构的潜在转变将成为时间序列预测管道中不可或缺的一部分。
各种时间序列预测方法的快速发展使得很难对高性能深度学习模型的构成进行比较和建立共识。虽然存在标准化数据集以对这些模型进行基准测试的努力，但比较往往忽略了整个机器学习生命周期中的关键方面，导致结果模糊，对模型改进提供的指导有限。例如，训练神经网络的既定技术，如课程学习、指数移动平均和漂移估计，很容易获得，但在目前的文献中很大程度上被忽视了。这些研究经常采用以模型为中心的视角，只关注预测算法本身。相反，我们的工作旨在通过全面考虑机器学习生命周期中的所有活动部分来解决这一差距。
为了实现这一目标，我们提出了一个统一的基准框架，使预测模型的评估标准化。这一框架有助于实施和比较最具影响力的时间序列预测模型，从而能够更全面和客观地评估其业绩。
我们的贡献如下:

1. 我们开发并开源了时间序列预测基准的标准化框架。该框架具有模块化组件，可以快速轻松地集成数据集、模型和训练技术。
2. 使用所提出的框架，重新实现和改进了最近流行的用于时间序列预测的深度学习模型，评估了它们在这些方法中常用数据集上的性能。
3. 从分配给这些模型调优和比较的大量计算资源中概述了各种观察结果。完整的代码和详细的实验报告在[这里](https://github.com/NVIDIA/DeepLearningExamples/tree/master/Tools/PyTorch/TimeSeriesPredictionPlatform)。

## 相关工作

时间序列预测的大多数研究都是围绕竞争展开的，参与者使用不同的方法。这些方法主要分为三大类:

1. 统计方法，如ARIMA;
1. 经典机器学习算法，包括支持向量机、梯度增强机;
2. 基于神经网络的方法，如TFT23、NHITS和NBEATS和MTGNN。

然而，在发表的方法中使用具有不同设置的数据集阻碍了准确的性能评估，并且难以确定明确的领先者。
尽管标准化基准实践的努力，跨方法的数据集的可变性阻碍了有意义的比较。在中，作者强调了数据集比较的局限性，因为不同的特征，如大小、特征数量和噪声水平。类似的观察结果也得到了莫纳什时间序列预测基准等基准的响应，该基准专门为模型比较整理数据集。然而，像这样的倡议侧重于将模型运行模式(单变量/多变量，局部/全局)分类作为比较的基础。相比之下，采用以模型为中心的方法，探索神经网络的架构变化。他们的发现表明，==缺乏一个通用的最佳架构，突出了模型性能的数据依赖性==。虽然这些研究承认缺乏标准化，但它们的重点要么以模型为中心，要么以数据为中心，这阻碍了对两者之间相互作用的全面理解。建立一个同时考虑这两个方面的标准化框架对于促进有意义的比较和时间序列预测的进步至关重要。
虽然深度学习模型越来越受欢迎，但最近的研究挑战了它们在更简单、更可解释的方法上的有效性。然而，我们认为深度学习模型并没有得到应有的认可。通过对整个机器学习生命周期的仔细考虑和适当的优化技术，我们相信这些模型可以实现超出其最初声称的功能的进一步改进.

## 时序预测架构

时间序列是按时间索引的一系列数据点，而预测则是从过去的历史数据中预测未来值的过程。尽管这个任务在言语中可以简单地描述，但对于这些模型来说，机器学习的生命周期却相当复杂，需要一个全面的机器学习流程，从数据的整理到模型的部署都得到覆盖。提出的框架概述如图1所示，包括以下组件：

- **数据**：对数据进行改进和整理，使其适用于模型训练的决策。这包括数据的选择、整理和清理。
- **训练**：关于输入数据和模型的决策，以提高下游性能。这包括根据输入数据定制的模型设计、优化和选择标准。
- **推断**：关于部署和对未知数据输入进行预测的决策。
- **调谐器**：一旦上述组件被定义，该组件选择顶级配置并将其用于部署后的模型监控、重新训练和不确定性量化.

### 任务描述

在时间序列预测中，我们有一个时间序列 $X=(x_{1},\ldots,x_{T}),x_{i}\in\mathbb{R}$，以预设的预测视界 $h\in\mathbb{N}$ 为目标。然后定义了质量指标 $\mathcal{L}:\mathbb{R}^h\times\mathbb{R}^h\to\mathbb{R}$ 来评价预测模型 $M:\mathbb{R}^T\to\mathbb{R}^h$ 的预测质量。目标是最小化这个度量$M:\mathbb{R}^T\to\mathbb{R}^h$的期望，其中 $X^{+}=(x_{T+1},\ldots,x_{T+h})$ 是一个表示真实未来值的序列。

### 数据方面

数据是机器学习应用程序的关键组成部分，并影响管道中做出的大多数决策。现实世界的时间序列数据集通常包含缺失值、噪声，并且不遵循许多基准数据集中看到的规律。大多数先前的工作认为数据是静态的，并且仅在模型/算法级别寻求改进。相反，在进行比较时，我们将数据修改视为整体建模工作的一部分。
扩展时间序列的定义。数据集 $\mathcal{D}=(X,C)$ 包含了一组序列 $X= \{X^1,\ldots,X^n\}$，其中 $X^i=(x_1^i,x_2^i,\ldots,x_T^i)$，$T$是时间序列的长度。与此同时，伴随 $X$ 的是一组协变量 $C = {C^1, \ldots , C^n}$，$C^i = (c^i_1, c^i_2, \ldots , c^i_T)$，其中时间序列和协变量都可以是任意维度的向量，即 $x_t^i\in \mathbb{R} ^d$  和 $c_t^i\in \mathbb{R} ^k$，$d$ 和 $k$ 分别是时间序列和协变量的维度。当 $d = 1$ 时，时间序列是单变量的；当 $d > 1$ 时，被视为多变量。
在这种数据集定义方式下，可能违反以下假设：

1. ***$X$ 中的序列相互独立*** - 这种情况下，数据集 $\mathcal{D}=(X,C,S)$ 中可能包含静态数据 $S$，其中可能包含序列之间的相关信息（比如用于数据收集的传感器的空间位置）；
2. ***$X$ 中的序列具有相同的长度*** - 这种情况下，长度 $T$ 可以在不同序列之间变化；
3. ***缺乏对未来的先验知识，实际上这可能包含在协变量或某个变量中*** - 这种情况下，协变量 $C$ 被分为两个不相交的集合：$C_o$ 包含我们对未来没有知识的协变量，而 $C_k$ 包含我们具有这种知识的协变量。例如，我们可能预先知道未来会发生的事件，或者我们对某些变量有完全控制权。

利用数据集 $\mathcal{D}$，数据分割模块生成相应的训练集 $\mathcal{D}_{train}$、验证集 $\mathcal{D}_{val}$ 和测试集 $\mathcal{D}_{test}$，并在各种方法中保持不变。然后，数据的形状会显著影响下游模型的使用方式。例如，底层方法可能对动态范围敏感，可能需要进行归一化，或者不能接受协变量作为附加输入，因此必须将其排除。预处理函数 $p$ 实现多种功能，如过滤、异常值去除、插补、标签修正、特征选择等。在每个预处理步骤，可能有多个可行的替代方法可应用于数据，以提高其对特定模型的质量，并在评估整体性能时应向调谐器公开。总体来说，$p$ 被设计以满足特定的建模条件和下游假设。

### 训练方面

一旦数据集准备好了，我们必须确定模型训练需要多少探索以及如何确保可靠的训练。一般来说，预测模型 $M$ 是一个函数，它将一系列观测值和协变量作为输入，并预测一系列预测输出：$$M(S,X,C)\mapsto\hat{X}^+\in\mathbb{R}^{d\times h}$$
由于计算资源有限，限制用于训练的数据很常见。这可以通过回溯窗口来实现，不同的模型有不同的回溯窗口。一个标准假设是，序列的最新值包含了与未来预测最相关的先验值。使用一个固定长度的回视窗口 $l$，从需要进行未来预测的索引开始。更具体地说，让 $X^{\prime}$ 成为从 $X$ 中截取最后 $l$ 个观测值的序列集合，即 $X^{\prime}:=\{(x_{T-l+1}^i,\ldots,x_T^i)|(x_1^i,\ldots x_T^i)\in X\}$，并类似地定义 $C_k^{\prime}$  和 $C_o^{\prime}$ 。遵循该假设，使用回溯窗口对历史数据进行近似处理：$$M(S,X,C_k,C_o)\approx M(S,X',C'_k,C'_o)$$ 其中，模型 $M$  既可以在全局水平上运行，即使用数据集中所有可用的时间序列来估计模型参数；也可以在局部水平上运行，即使用数据集中的单个时间序列来估计模型参数。$M$ 的选择还可能导致不同的训练参数，其中包括优化参数、初始化、目标、是否应用课程学习、指数移动平均（EMA）等。这些参数集还必须与模型探索一起考虑，这将在第 3.5 节中讨论。因此，考虑控制模型复杂度和训练复杂度的参数范围非常重要。

### 推理方面

成功的模型通常依赖于对其旨在预测的序列的某些假设，如数据的静止性或无间隙。一般来说，模型预测的预测窗口由下游任务设定，结果是预测结果 $X^i_{+} = (x^i_{T+1}, \ldots , x^i_{T+h})$。与 3.2 节中定义的转换原始序列的预处理函数 $p$ 相似，后处理函数 $p^{\prime}$  对预测窗口进行操作，以逆转预处理步骤的某些方面（例如，归一化），并纳入有关如何解释预测窗口的领域专家知识（例如，产品销售额不能为负并设置下限）。

成功的模型通常依赖于对其旨在预测的数据的某些假设，如序列的静止性和无间隙。这些假设简化了建模过程，使预测更加准确。然而，现实世界的数据很少能完全符合这些假设。为了弥补这一点，通常会采用类似于预处理的技术，将原始数据转换成满足模型输出要求的格式。

模型预测的预测窗口通常由其服务的下游任务决定。例如，一个销售预测模型的设计目的可能是预测下个月的产品需求，预测窗口 $X^i_{+} = (x^i_{T+1}, \ldots , x^i_{T+h})$，其中 $T$ 是当前时间，$h$ 是预测范围。

在预处理为建模准备数据的同时，后处理步骤确保预测值可解释并与领域知识保持一致。后处理函数（用 $p^{\prime}$ 表示）在预测窗口上运行，并执行几项关键任务。它逆转预处理步骤的某些方面，如去归一化，将预测值返回到原始单位。此外，它还纳入了特定领域的知识，以确保预测符合现实世界的限制条件。例如，产品销售的后处理函数可能会强制执行非负约束，防止模型预测出负的销售数字。

通过结合预处理和后处理步骤，我们可以充分利用机器学习模型的优势，同时确保预测结果可解释并适用于特定领域。
